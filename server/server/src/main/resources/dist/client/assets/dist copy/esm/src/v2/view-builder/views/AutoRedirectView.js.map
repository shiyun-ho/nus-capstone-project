{"version":3,"file":"AutoRedirectView.js","sources":["../../../../../../src/v2/view-builder/views/AutoRedirectView.js"],"sourcesContent":["import { _, loc, createCallout } from '@okta/courage';\nimport { BaseForm, BaseView } from '../internals';\nimport { INTERSTITIAL_REDIRECT_VIEW } from '../../ion/RemediationConstants';\nimport CustomAccessDeniedErrorMessage from '../views/shared/CustomAccessDeniedErrorMessage';\n\nconst CUSTOM_ACCESS_DENIED_KEY = 'security.access_denied_custom_message';\nconst UNLOCK_USER_SUCCESS_MESSAGE = 'oie.selfservice.unlock_user.landing.to.app.success.message';\n\nconst Body = BaseForm.extend({\n  title() {\n    let titleString = loc('oie.success.text.signingIn', 'login');\n    // For more info on the API response available in appState, see IdxResponseBuilder.java\n    const app = this.options.appState.get('app');\n    const user = this.options.appState.get('user');\n\n    // If the option is not set, we treat that as being the case where we don't render the spinner.\n    // This is to account for the customer hosted scenario, because by default okta-core will pass in\n    // the correct value as set by the option in the Admin UI (which by default is \"DEFAULT\").\n    if (!this.redirectView || this.redirectView === INTERSTITIAL_REDIRECT_VIEW.NONE) {\n      titleString = loc('oie.success.text.signingIn.with.ellipsis', 'login');\n      return titleString;\n    }\n\n    if (_.isEmpty(app)) {\n      return titleString;\n    }\n\n    const { label: appInstanceName, name: appDisplayName } = app;\n    const { identifier: userEmail } = user || {};\n\n    const appName = appInstanceName ? appInstanceName : appDisplayName;\n\n    if (appName && userEmail && !this.settings.get('features.showIdentifier')) {\n      titleString = loc('oie.success.text.signingIn.with.appName.and.identifier', 'login', [appName, userEmail]);\n    } else if (appName) {\n      titleString = loc('oie.success.text.signingIn.with.appName', 'login', [appName]);\n    }\n\n    return titleString;\n  },\n  showMessages() {\n    if (this.isUnlockSuccess()) {\n      const container = '.o-form-error-container';\n      const text = loc('oie.selfservice.unlock_user.landing.to.app.signing.in.message', 'login');\n      this.add(`<div class=\"ion-messages-container\"><p>${text}</p></div>`, container);\n      return;\n    } else if (this.options.appState.containsMessageStartingWithI18nKey(CUSTOM_ACCESS_DENIED_KEY)) {\n      const { message, links } = this.options.appState.get('messages').value.find(\n        msg => msg.i18n.key === CUSTOM_ACCESS_DENIED_KEY);\n      this.add(createCallout({\n        type: 'error',\n        content: new CustomAccessDeniedErrorMessage({ message, links })\n      }));\n      return;\n    }\n    BaseForm.prototype.showMessages.call(this);\n  },\n  isUnlockSuccess() {\n    return this.options.appState.containsMessageWithI18nKey(UNLOCK_USER_SUCCESS_MESSAGE);\n  },\n  noButtonBar: true,\n  initialize() {\n    BaseForm.prototype.initialize.apply(this, arguments);\n    this.redirectView = this.settings.get('interstitialBeforeLoginRedirect');\n    this.model.set('useRedirect', true);\n    this.trigger('save', this.model);\n  },\n\n  render() {\n    BaseForm.prototype.render.apply(this, arguments);\n    if (this.redirectView === INTERSTITIAL_REDIRECT_VIEW.DEFAULT) {\n      this.add('<div class=\"okta-waiting-spinner\"></div>');\n    }\n  }\n});\n\nexport default BaseView.extend({\n  Body\n});\n"],"names":["CUSTOM_ACCESS_DENIED_KEY","UNLOCK_USER_SUCCESS_MESSAGE","Body","BaseForm","extend","title","titleString","loc","app","options","appState","get","user","redirectView","INTERSTITIAL_REDIRECT_VIEW","NONE","_","isEmpty","label","appInstanceName","name","appDisplayName","identifier","userEmail","appName","settings","showMessages","isUnlockSuccess","container","text","add","containsMessageStartingWithI18nKey","message","links","value","find","msg","i18n","key","createCallout","type","content","CustomAccessDeniedErrorMessage","prototype","call","containsMessageWithI18nKey","noButtonBar","initialize","apply","arguments","model","set","trigger","render","DEFAULT","BaseView"],"mappings":"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"}